{"ast":null,"code":"export default {\n  name: 'ThankYouView',\n  data() {\n    return {\n      ref: null,\n      method: null,\n      order: [],\n      page: {\n        headline1: '',\n        textarea1: '',\n        headline2: '',\n        textarea2: null,\n        cta: '',\n        externalLink: null\n      },\n      downloadables: [],\n      error: []\n    };\n  },\n  mounted() {\n    if (this.$route.query.order) {\n      this.ref = this.$route.query.order;\n      this.code = this.$route.query.coupon;\n      this.method = 'coupon';\n    }\n    if (this.$route.query.session) {\n      this.ref = this.$route.query.order;\n      this.session = this.$route.query.session;\n      this.method = 'stripe';\n    }\n    if (this.$route.query.preview) {\n      /*requires a url query string with email and teaser_id*/\n      this.ref = this.$route.query.preview;\n      this.session = this.$route.query.email;\n      this.method = 'teaser';\n    }\n    this.getPage();\n    this.getOrderSummary();\n  },\n  methods: {\n    calcCHF(price) {\n      return `CHF ${parseFloat(price).toFixed(2)}`;\n    },\n    getOrderSummary: async function () {\n      const url = `${this.rest_base}order-summary`;\n      const data = {\n        ref: this.ref\n      };\n      const headers = {\n        credentials: \"same-origin\",\n        \"Content-Type\": \"application/json\",\n        \"X-WP-Nonce\": this.nonce\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(data)\n      }).then(result => result.json()).then(result => {\n        this.order = result;\n      }).then(() => {\n        if (this.method === 'coupon') {\n          this.doCouponCheck(this.order.coupon_code);\n        }\n        if (this.method === 'stripe') {\n          this.doStripeCheck();\n        }\n        if (this.method === 'teaser') {\n          this.getTeaserFile();\n        }\n      });\n    },\n    doStripeCheck: async function () {\n      // Does order id match the one in stripe session?\n      const url = `${this.rest_base}stripe-check`;\n      const data = {\n        session_id: this.session,\n        order_id: this.ref\n      };\n      const headers = {\n        credentials: \"same-origin\",\n        \"Content-Type\": \"application/json\",\n        \"X-WP-Nonce\": this.nonce\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(data)\n      }).then(result => result.json()).then(result => {\n        if (result[0] === 'success') {\n          this.downloadFiles();\n        } else {\n          this.doCriticalError(result);\n        }\n      });\n    },\n    doCouponCheck: function () {\n      // Does given coupon code match the one in order?\n      if (this.code !== this.order.coupon_code) {\n        this.doCriticalError();\n      }\n      this.downloadFiles();\n    },\n    getPage: async function () {\n      const url = `${this.rest_base}get-page`;\n      const data = {\n        slug: 'thank-you'\n      };\n      const headers = {\n        credentials: \"same-origin\",\n        \"Content-Type\": \"application/json\",\n        \"X-WP-Nonce\": this.nonce\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(data)\n      }).then(result => result.json()).then(result => {\n        this.page = result;\n      });\n    },\n    downloadFiles: async function () {\n      const url = `${this.rest_base}download-files`;\n      const check = this.method === 'coupon' ? this.order.coupon_code : this.session;\n      const data = {\n        ref: this.ref,\n        method: this.method,\n        check: check\n      };\n      const headers = {\n        credentials: \"same-origin\",\n        \"Content-Type\": \"application/json\",\n        \"X-WP-Nonce\": this.nonce\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(data)\n      }).then(result => result.json()).then(result => {\n        if (Array.isArray(result) && result[0] !== 'error') {\n          this.downloadables = result;\n        } else {\n          this.doCriticalError(result);\n        }\n      });\n    },\n    getTeaserFile: async function () {\n      const url = `${this.rest_base}teaser-file`;\n      const check = this.session;\n      const data = {\n        ref: this.ref,\n        method: this.method,\n        check: check\n      };\n      const headers = {\n        credentials: \"same-origin\",\n        \"Content-Type\": \"application/json\",\n        \"X-WP-Nonce\": this.nonce\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(data)\n      }).then(result => result.json()).then(result => {\n        if (result[0] && result[0] === 'error') {\n          this.doCriticalError(result);\n        } else {\n          this.downloadables = result;\n        }\n      });\n    },\n    doCriticalError: function (err) {\n      this.error = err;\n    },\n    decode(s) {\n      var e = {},\n        i,\n        b = 0,\n        c,\n        x,\n        l = 0,\n        a,\n        r = '',\n        w = String.fromCharCode,\n        L = s.length;\n      var A = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n      for (i = 0; i < 64; i++) {\n        e[A.charAt(i)] = i;\n      }\n      for (x = 0; x < L; x++) {\n        c = e[s.charAt(x)];\n        b = (b << 6) + c;\n        l += 6;\n        while (l >= 8) {\n          ((a = b >>> (l -= 8) & 0xff) || x < L - 2) && (r += w(a));\n        }\n      }\n      return r;\n    },\n    unencryptDownload: function (url, name) {\n      const decoded = this.decode(url);\n      var link = document.createElement('a');\n      link.href = decoded;\n      link.style.display = 'none';\n      link.download = name;\n      document.body.appendChild(link);\n      link.click();\n    }\n  }\n};","map":{"version":3,"names":["name","data","ref","method","order","page","headline1","textarea1","headline2","textarea2","cta","externalLink","downloadables","error","mounted","$route","query","code","coupon","session","preview","email","getPage","getOrderSummary","methods","calcCHF","price","parseFloat","toFixed","url","rest_base","headers","credentials","nonce","fetch","body","JSON","stringify","then","result","json","doCouponCheck","coupon_code","doStripeCheck","getTeaserFile","session_id","order_id","downloadFiles","doCriticalError","slug","check","Array","isArray","err","decode","s","e","i","b","c","x","l","a","r","w","String","fromCharCode","L","length","A","charAt","unencryptDownload","decoded","link","document","createElement","href","style","display","download","appendChild","click"],"sources":["src/views/ThankYouView.vue"],"sourcesContent":["<template>\r\n    <div class=\"page-wrap\">\r\n        <section class=\"section1\">\r\n            <div class=\"col col1\">\r\n                <h1 class=\"section-title\">{{ page.headline1 }}</h1>\r\n                <div v-html=\"page.textarea1\"></div>\r\n                <div v-html=\"page.textarea2\"></div>\r\n                <div class=\"results-box all-ok\" v-if=\"downloadables && !error\">\r\n                    <ul>\r\n                        <li v-for=\"(item, index) in downloadables\" :key=\"index\" v-html=\"item.name\" @click=\"unencryptDownload(item.url, item.name)\"></li>\r\n                    </ul>\r\n                </div>\r\n                <div class=\"results-box error\" v-else>\r\n                    <h3>Error</h3>\r\n                    <span v-html=\"error[1]\"></span>\r\n                </div>\r\n            </div>\r\n            <div class=\"col col2\">\r\n                <div class=\"order-details-wrap\">\r\n                    <h3>Your order details</h3>\r\n                    <div class=\"order-summary-item\">\r\n                        <h5>Order reference:</h5>\r\n                        <span>{{ order.order_id }}</span>\r\n                    </div>\r\n                    <div class=\"order-summary-item\">\r\n                        <h5>Order date: </h5>\r\n                        <span>{{ order.order_date }}</span>\r\n                    </div>\r\n                    <div class=\"order-summary-item\">\r\n                        <h5>Order total: </h5>\r\n                        <span v-html=\"calcCHF(order.order_total)\"></span>\r\n                    </div>\r\n                    <div class=\"order-summary-item\">\r\n                        <h5>Payment method: </h5>\r\n                        <span>{{ order.payment_method }}&nbsp;</span>\r\n                        <span v-if=\"order.coupon_code\">({{ order.coupon_code }})</span>\r\n                    </div>\r\n                    <div class=\"order-summary-list\">\r\n                        <h5>Order items:</h5>\r\n                        <ul>\r\n                            <li v-for=\"(item, index) in order.order_items\" :key=\"index\">{{ item }}</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: 'ThankYouView',\r\n    data() {\r\n        return {\r\n            ref: null,\r\n            method: null,\r\n            order: [],\r\n            page: {\r\n                headline1: '',\r\n                textarea1: '',\r\n                headline2: '',\r\n                textarea2: null,\r\n                cta: '',\r\n                externalLink: null,\r\n            },\r\n            downloadables: [],\r\n            error: [],\r\n        }\r\n    },\r\n    mounted() {\r\n        if(this.$route.query.order) {\r\n            this.ref = this.$route.query.order;\r\n            this.code = this.$route.query.coupon;\r\n            this.method = 'coupon';\r\n        }\r\n        if(this.$route.query.session) {\r\n            this.ref = this.$route.query.order;\r\n            this.session = this.$route.query.session;\r\n            this.method = 'stripe';\r\n        }\r\n        if(this.$route.query.preview) { /*requires a url query string with email and teaser_id*/\r\n            this.ref = this.$route.query.preview;\r\n            this.session = this.$route.query.email;\r\n            this.method = 'teaser';\r\n        }\r\n        this.getPage();\r\n        this.getOrderSummary();\r\n    },\r\n    methods: {\r\n        calcCHF(price) {\r\n            return `CHF ${parseFloat(price).toFixed(2)}`;\r\n        },\r\n        getOrderSummary: async function() {\r\n            const url = `${this.rest_base}order-summary`;\r\n            const data = {\r\n                ref: this.ref,\r\n            };\r\n            const headers = {\r\n                credentials: \"same-origin\",\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-WP-Nonce\": this.nonce,\r\n            };\r\n            fetch(url, { method: \"POST\", headers, body: JSON.stringify(data) })\r\n                .then((result) => result.json())\r\n                .then((result) => { \r\n                    this.order = result;\r\n                })\r\n                .then(() => { \r\n                    \r\n                    if(this.method === 'coupon') {\r\n                        this.doCouponCheck(this.order.coupon_code);\r\n                    }\r\n\r\n                    if(this.method === 'stripe') {\r\n                        this.doStripeCheck();\r\n                    }\r\n\r\n                    if(this.method === 'teaser') {\r\n                        this.getTeaserFile();\r\n                    }\r\n\r\n                });\r\n        },\r\n        doStripeCheck: async function() {\r\n            // Does order id match the one in stripe session?\r\n            const url = `${this.rest_base}stripe-check`;\r\n            const data = {\r\n                session_id: this.session,\r\n                order_id: this.ref,\r\n            };\r\n            const headers = {\r\n                credentials: \"same-origin\",\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-WP-Nonce\": this.nonce,\r\n            };\r\n            fetch(url, { method: \"POST\", headers, body: JSON.stringify(data) })\r\n                .then((result) => result.json())\r\n                .then((result) => { \r\n                    if(result[0] === 'success') {\r\n                        this.downloadFiles();\r\n                    } else {\r\n                        this.doCriticalError(result);\r\n                    }\r\n                });\r\n        },\r\n        doCouponCheck: function() {\r\n            // Does given coupon code match the one in order?\r\n            if(this.code !== this.order.coupon_code) {\r\n                this.doCriticalError();\r\n            }\r\n            this.downloadFiles();\r\n\r\n        },\r\n        getPage: async function() {\r\n            const url = `${this.rest_base}get-page`;\r\n            const data = { slug: 'thank-you' };\r\n            const headers = {\r\n                credentials: \"same-origin\",\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-WP-Nonce\": this.nonce,\r\n            };\r\n            fetch(url, { method: \"POST\", headers, body: JSON.stringify(data) })\r\n                .then((result) => result.json())\r\n                .then((result) => { this.page = result; });\r\n        },\r\n        downloadFiles: async function() {\r\n            const url = `${this.rest_base}download-files`;\r\n            const check = this.method === 'coupon' ? this.order.coupon_code : this.session;\r\n            const data = { ref: this.ref, method: this.method, check: check };\r\n            const headers = {\r\n                credentials: \"same-origin\",\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-WP-Nonce\": this.nonce,\r\n            };\r\n            fetch(url, { method: \"POST\", headers, body: JSON.stringify(data) })\r\n                .then((result) => result.json())\r\n                .then((result) => { \r\n                    if(Array.isArray(result) && result[0] !== 'error') {\r\n                        this.downloadables = result;\r\n                    } else {\r\n                        this.doCriticalError(result);\r\n                    }\r\n                });\r\n        },\r\n        getTeaserFile: async function() {\r\n            const url = `${this.rest_base}teaser-file`;\r\n            const check = this.session;\r\n            const data = { ref: this.ref, method: this.method, check: check };\r\n            const headers = {\r\n                credentials: \"same-origin\",\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-WP-Nonce\": this.nonce,\r\n            };\r\n            fetch(url, { method: \"POST\", headers, body: JSON.stringify(data) })\r\n                .then((result) => result.json())\r\n                .then((result) => { \r\n                    if(result[0] && result[0] === 'error') {\r\n                        this.doCriticalError(result);\r\n                    } else {\r\n                        this.downloadables = result;\r\n                    }\r\n                });\r\n        },\r\n        doCriticalError: function(err) {\r\n            this.error = err;\r\n        },\r\n        decode(s) {\r\n            var e={},i,b=0,c,x,l=0,a,r='',w=String.fromCharCode,L=s.length;\r\n            var A=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n            for(i=0;i<64;i++){e[A.charAt(i)]=i;}\r\n            for(x=0;x<L;x++){\r\n                c=e[s.charAt(x)];b=(b<<6)+c;l+=6;\r\n                while(l>=8){((a=(b>>>(l-=8))&0xff)||(x<(L-2)))&&(r+=w(a));}\r\n            }\r\n            return r;\r\n        },\r\n        unencryptDownload: function(url, name) {\r\n            const decoded = this.decode(url);\r\n            var link = document.createElement('a');\r\n            link.href = decoded;\r\n            link.style.display = 'none';\r\n            link.download = name;\r\n            document.body.appendChild(link);\r\n            link.click();   \r\n        },\r\n    }\r\n}\r\n\r\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}